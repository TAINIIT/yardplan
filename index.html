<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yard Plan Detail</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .form-input, .form-select {
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            padding: 0.5rem 0.75rem;
            width: 100%;
            background-color: #ffffff;
            transition: border-color 0.2s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 1px #3b82f6;
        }
        .form-label {
            font-weight: 500;
            color: #4b5563;
            white-space: nowrap;
        }
        .section-container {
            border: 5px solid #3b82f6; /* Made border thicker and blue */
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 2rem;
            background-color: #ffffff;
            position: relative;
        }
        .section-title {
            position: absolute;
            top: -0.875rem;
            left: 1rem;
            background-color: #ffffff;
            padding: 0 0.5rem;
            font-weight: 700; /* Made title bold */
            color: #374151;
        }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .input-group-append {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 0.75rem;
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            border-left: 0;
            border-radius: 0 0.375rem 0.375rem 0;
        }
        .data-row.selected {
            background-color: #bfdbfe;
        }
        .warehouse-grid {
            display: grid;
            gap: 1px;
            background-color: #d1d5db;
            border: 1px solid #d1d5db;
            overflow-x: auto;
            padding: 1px;
            user-select: none; /* Prevent text selection during drag */
        }
        .warehouse-cell {
            background-color: #f9fafb;
            min-height: 50px;
            min-width: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: #6b7280;
            border: 1px solid transparent;
        }
        .warehouse-cell.occupied {
            background-color: #fdba74; /* Orange-300 */
        }
        .warehouse-cell.selected-by-drag {
            background-color: #93c5fd; /* A light blue for selection */
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-screen-2xl mx-auto bg-white rounded-lg shadow-lg">
        <!-- Header -->
        <header class="bg-blue-600 text-white p-4 flex justify-between items-center rounded-t-lg">
            <h1 class="text-xl font-bold"Yard Plan Detail"</h1>
            <div class="flex items-center space-x-2">
                <button class="btn bg-blue-500 hover:bg-blue-700 text-white w-auto">
                    <i class="fas fa-save mr-2"></i> Save
                </button>
                <button class="btn bg-gray-200 hover:bg-gray-300 text-gray-800 w-auto">
                    <i class="fas fa-times mr-2"></i> Close
                </button>
            </div>
        </header>

        <main class="p-4 md:p-6">
            <!-- Request Info Section -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 items-center">
                <label for="request-no" class="form-label lg:col-span-1">Request No:</label>
                <div class="lg:col-span-2">
                    <input type="text" id="request-no" class="form-input" value="REQ25020001">
                </div>

                <label for="requester-id" class="form-label lg:col-span-1 lg:text-right">Requester:</label>
                <div class="lg:col-span-3 flex">
                    <input type="text" id="requester-id" class="form-input rounded-r-none" value="TSBDBADMIN">
                    <button class="input-group-append hover:bg-gray-200">
                        <i class="fas fa-search text-gray-600"></i>
                    </button>
                    <input type="text" id="requester-name" class="form-input ml-2" value="TSBDBADMIN" readonly>
                </div>
                
                <label for="request-type" class="form-label lg:col-span-1 lg:text-right">Request Type:</label>
                <div class="lg:col-span-1">
                    <select id="request-type" class="form-select">
                        <option selected>Space</option>
                        <option>Movement</option>
                    </select>
                </div>

                <label for="status" class="form-label lg:col-span-1 lg:text-right">Status:</label>
                <div class="lg:col-span-1">
                    <input type="text" id="status" class="form-input" value="Planned" readonly>
                </div>
                
                <div class="lg:col-span-1">
                    <button class="btn btn-primary w-full">Submit</button>
                </div>
            </div>

            <!-- Vessel/Cargo Section -->
            <div class="section-container">
                <h2 class="section-title">Vessel/Cargo</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-x-6 gap-y-4">
                     <div class="lg:col-span-3 flex items-center space-x-4">
                        <div class="flex items-center">
                            <input type="radio" id="non-jpvc" name="vessel-type" class="form-radio h-4 w-4 text-blue-600">
                            <label for="non-jpvc" class="ml-2 form-label">Non-JPVC</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="jpvc" name="vessel-type" class="form-radio h-4 w-4 text-blue-600" checked>
                            <label for="jpvc" class="ml-2 form-label">JPVC</label>
                        </div>
                    </div>
                    <div class="lg:col-span-3 flex">
                        <input type="text" id="jpvc-id" class="form-input rounded-r-none" value="24NPST-V01">
                        <button class="input-group-append hover:bg-gray-200">
                            <i class="fas fa-search text-gray-600"></i>
                        </button>
                    </div>
                    <label for="sn-select" class="form-label lg:col-span-1 self-center lg:text-right">S/N:</label>
                    <div class="lg:col-span-2">
                        <select id="sn-select" class="form-select"><option>Select</option></select>
                    </div>
                    <label for="gr-select" class="form-label lg:col-span-1 self-center lg:text-right">GR:</label>
                    <div class="lg:col-span-2">
                        <select id="gr-select" class="form-select"><option>Select</option></select>
                    </div>
                    <label for="category" class="form-label lg:col-span-1 self-center">Category:</label>
                    <div class="lg:col-span-2">
                        <input type="text" id="category" class="form-input" value="I">
                    </div>
                    <label for="bl-np01" class="form-label lg:col-span-1 self-center lg:text-right">B/L:</label>
                    <div class="lg:col-span-2">
                         <select id="bl-np01" class="form-select"><option selected>NP01</option></select>
                    </div>
                    <div class="lg:col-span-6"></div>
                    <label for="cargo-type" class="form-label lg:col-span-1 self-center">Cargo Type:</label>
                    <div class="lg:col-span-2">
                        <input type="text" id="cargo-type" class="form-input" value="Break Bulk Cargo">
                    </div>
                    <label for="package-type" class="form-label lg:col-span-1 self-center lg:text-right">Package Type:</label>
                    <div class="lg:col-span-2">
                        <input type="text" id="package-type" class="form-input" value="BAGGED GOODS IN GENERAL">
                    </div>
                    <label for="dg" class="form-label lg:col-span-1 self-center lg:text-right">DG:</label>
                    <div class="lg:col-span-2">
                        <select id="dg" class="form-select"><option>N</option><option>Y</option></select>
                    </div>
                    <div class="lg:col-span-3"></div>
                    <label for="mt" class="form-label lg:col-span-1 self-center">MT:</label>
                    <div class="lg:col-span-2"><input type="text" id="mt" class="form-input"></div>
                    <label for="m3" class="form-label lg:col-span-1 self-center lg:text-right">M3:</label>
                    <div class="lg:col-span-2"><input type="text" id="m3" class="form-input"></div>
                    <label for="qty" class="form-label lg:col-span-1 self-center lg:text-right">Qty:</label>
                    <div class="lg:col-span-2"><input type="text" id="qty" class="form-input"></div>
                     <div class="lg:col-span-3"></div>
                    <label for="shipper" class="form-label lg:col-span-2 self-center">Shipper/Consignee:</label>
                    <div class="lg:col-span-10">
                        <input type="text" id="shipper" class="form-input" value="MEKONG FOOD CORP/PADIBERAS NASIONAL BERHAD (BERNAS)">
                    </div>
                    <label for="location-cargo-input" class="form-label lg:col-span-2 self-center">Location:</label>
                    <div class="lg:col-span-3 flex">
                        <input type="text" id="location-cargo-input" class="form-input rounded-r-none" value="Cell">
                        <button class="input-group-append hover:bg-gray-200">
                            <i class="fas fa-search text-gray-600"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Area Section -->
            <div class="section-container">
                <h2 class="section-title">Area</h2>
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-x-6 gap-y-4 items-start">
                    <!-- Form fields -->
                    <div class="lg:col-span-10 grid grid-cols-1 md:grid-cols-10 gap-x-6 gap-y-4 items-center">
                         <label for="location-area-id" class="form-label md:col-span-1">Location:</label>
                        <div class="md:col-span-3 flex">
                            <input type="text" id="location-area-id" class="form-input rounded-r-none" value="CLOSED SHED 782">
                            <button class="input-group-append hover:bg-gray-200"><i class="fas fa-search text-gray-600"></i></button>
                            <input type="text" id="location-area-cell" class="form-input ml-2" value="Cell">
                        </div>

                        <label for="est-arrival" class="form-label md:col-span-2 text-right">Est. Arrival Date:</label>
                        <div class="md:col-span-4 flex">
                            <input type="text" id="est-arrival" class="form-input rounded-r-none" value="17/07/2025 14:00">
                            <span class="input-group-append"><i class="fas fa-calendar-alt text-gray-600"></i></span>
                        </div>

                        <label for="area-size" class="form-label md:col-span-1">Area size:</label>
                        <div class="md:col-span-1 flex items-center">
                            <input type="text" id="area-size" class="form-input">
                            <span class="ml-2">M2</span>
                        </div>
                        <label for="area-mt" class="form-label md:col-span-1 text-right">MT:</label>
                        <div class="md:col-span-1 flex items-center">
                            <input type="text" id="area-mt" class="form-input" value="1850">
                        </div>
                        
                        <label for="est-delivery" class="form-label md:col-span-2 text-right">Est. Delivery Date:</label>
                        <div class="md:col-span-4 flex">
                            <input type="text" id="est-delivery" class="form-input rounded-r-none" value="27/07/2025 14:00">
                            <span class="input-group-append"><i class="fas fa-calendar-alt text-gray-600"></i></span>
                        </div>

                        <label for="period" class="form-label md:col-span-1">Period:</label>
                        <div class="md:col-span-1 flex items-center">
                            <input type="text" id="period" class="form-input" value="10">
                            <span class="ml-2">Days</span>
                        </div>
                        <div class="md:col-span-8"></div>

                        <label for="remark" class="form-label md:col-span-1">Remark:</label>
                        <div class="md:col-span-9"><input type="text" id="remark" class="form-input"></div>
                    </div>
                    
                    <!-- Buttons -->
                    <div class="lg:col-span-2 flex flex-col space-y-2">
                        <button id="add-button" class="btn btn-primary"><i class="fas fa-plus mr-2"></i> Add</button>
                        <button id="remove-button" class="btn bg-red-500 text-white hover:bg-red-600"><i class="fas fa-minus mr-2"></i> Remove</button>
                        <button id="refresh-button" class="btn btn-secondary"><i class="fas fa-sync-alt mr-2"></i> Refresh</button>
                    </div>
                </div>
            </div>

            <!-- Warehouse View Section -->
            <div class="section-container">
                <h2 class="section-title">Warehouse View</h2>
                <div class="flex items-center mb-4">
                    <label for="warehouse-select" class="form-label mr-4">Warehouse:</label>
                    <select id="warehouse-select" class="form-select w-64">
                        <option value="1">Warehouse 1</option>
                        <option value="2">Warehouse 2</option>
                        <option value="3">Warehouse 3</option>
                        <option value="4">Warehouse 4</option>
                        <option value="5">Warehouse 5</option>
                    </select>
                </div>
                <div id="warehouse-grid" class="warehouse-grid">
                    <!-- Warehouse cells will be generated here by JavaScript -->
                </div>
            </div>

            <!-- Request Table -->
            <div class="mt-6 overflow-x-auto">
                <table class="min-w-full bg-white border border-gray-300">
                     <thead class="bg-gray-50">
                        <tr>
                            <th class="py-2 px-3 border-b text-left">
                                <input type="checkbox" id="select-all-checkbox">
                            </th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">#</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Request Type</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">CA</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">JPVC</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">BL/SN</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">GR</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">S.Agent</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">F.Agent</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Cng/Shp</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Plan LOC</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">M2</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">MT</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Est. Arrival Date</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Period</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Cargo Type</th>
                            <th class="py-2 px-3 border-b text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">DG</th>
                        </tr>
                    </thead>
                    <tbody id="data-grid-body">
                        <!-- Data rows will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dataGridBody = document.getElementById('data-grid-body');
            const selectAllCheckbox = document.getElementById('select-all-checkbox');

            // --- DYNAMIC DATA GENERATION ---
            const generateData = () => {
                let tableContent = '';
                const requestTypes = ['Space', 'Movement'];
                const caTypes = ['I', 'E'];
                const agents = ['SAIL', 'MAERSK', 'COSCO', 'MSC', 'CMA CGM'];
                const shippers = ['MEKONG FOOD CORP...', 'GLOBAL SHIPPING LTD...', 'OCEANIC TRADERS...', 'EASTERN CARGO...', 'PACIFIC LOGISTICS...'];
                const locations = ['CS 782', 'OPEN YARD 1', 'WAREHOUSE 5', 'SHED 3', 'CFS-1'];
                const cargoTypes = ['Break Bulk Cargo', 'Container', 'Liquid Bulk', 'Dry Bulk'];
                const dgTypes = ['N', 'Y'];

                for (let i = 1; i <= 100; i++) {
                    const reqType = requestTypes[i % 2];
                    const ca = caTypes[i % 2];
                    const jpvc = `24${String.fromCharCode(65 + (i % 26))}${String.fromCharCode(65 + ((i+1) % 26))}${String.fromCharCode(65 + ((i+2) % 26))}-V${String(i).padStart(2,'0')}`;
                    const blsn = `NP${String(i).padStart(2,'0')}`;
                    const agent = agents[i % agents.length];
                    const shipper = shippers[i % shippers.length];
                    const reqLoc = locations[i % locations.length];
                    const planLoc = `${reqLoc}(${String.fromCharCode(65 + (i % 5))}${i % 3 + 1},${i % 4 + 1})`;
                    const m2 = (i % 5) * 100;
                    const mt = (Math.random() * 2000 + 500).toFixed(2);
                    const date = new Date(2025, 6, 17 + (i%30));
                    date.setHours(10 + (i%10), 50 + (i%9));
                    const estArrival = `${date.getDate().toString().padStart(2,'0')}/${(date.getMonth()+1).toString().padStart(2,'0')}/${date.getFullYear()} ${date.getHours()}:${date.getMinutes()}`;
                    const period = 5 + (i % 15);
                    const cargo = cargoTypes[i % cargoTypes.length];
                    const dg = dgTypes[i % 2];

                    tableContent += `
                        <tr class="data-row cursor-pointer hover:bg-gray-100">
                            <td class="py-2 px-3 border-b">
                                <input type="checkbox" class="data-row-checkbox">
                            </td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${i}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${reqType}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${ca}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${jpvc}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${blsn}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700"></td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${agent}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700"></td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${shipper}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${planLoc}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${m2}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${mt}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${estArrival}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${period}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${cargo}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-700">${dg}</td>
                        </tr>
                    `;
                }
                dataGridBody.innerHTML = tableContent;
            };
            
            generateData();
            addEventListenersToRows();

            // --- ADD EVENT LISTENERS FUNCTION ---
            function addEventListenersToRows() {
                const allCheckboxes = document.querySelectorAll('.data-row-checkbox');
                selectAllCheckbox.addEventListener('change', (e) => {
                    allCheckboxes.forEach(checkbox => {
                        checkbox.checked = e.target.checked;
                        checkbox.closest('tr').classList.toggle('selected', e.target.checked);
                    });
                });

                allCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        e.target.closest('tr').classList.toggle('selected', e.target.checked);
                        if (!e.target.checked) {
                            selectAllCheckbox.checked = false;
                        }
                    });
                });

                const dataRows = document.querySelectorAll('.data-row');
                dataRows.forEach(row => {
                    row.addEventListener('click', (e) => {
                        if (e.target.matches('.data-row-checkbox')) {
                            return;
                        }
                        const checkbox = row.querySelector('.data-row-checkbox');
                        if (checkbox) {
                            checkbox.checked = !checkbox.checked;
                            checkbox.dispatchEvent(new Event('change'));
                        }
                    });
                });
            }


            // --- WAREHOUSE VIEW DRAG-AND-DROP LOGIC ---
            const warehouseSelect = document.getElementById('warehouse-select');
            const warehouseGrid = document.getElementById('warehouse-grid');
            const locationAreaIdInput = document.getElementById('location-area-id');
            const locationAreaCellInput = document.getElementById('location-area-cell');
            let isDragging = false;

            const warehouseLayouts = {
                '1': { rows: 6, cols: 10, occupied: [2, 5, 15, 33, 45, 50] },
                '2': { rows: 8, cols: 12, occupied: [1, 10, 12, 24, 40, 60, 75, 90] },
                '3': { rows: 5, cols: 8, occupied: [3, 8, 18, 25, 35] },
                '4': { rows: 7, cols: 14, occupied: [4, 14, 28, 42, 56, 70, 84, 98] },
                '5': { rows: 10, cols: 15, occupied: [5, 15, 30, 45, 60, 75, 90, 105, 120, 135, 150] }
            };

            const renderWarehouseGrid = () => {
                const selectedWarehouse = warehouseSelect.value;
                const layout = warehouseLayouts[selectedWarehouse];
                if (!layout) return;

                warehouseGrid.innerHTML = '';
                warehouseGrid.style.gridTemplateColumns = `repeat(${layout.cols}, minmax(0, 1fr))`;

                for (let i = 0; i < layout.rows * layout.cols; i++) {
                    const cell = document.createElement('div');
                    cell.classList.add('warehouse-cell');
                    if (layout.occupied.includes(i + 1)) {
                        cell.classList.add('occupied');
                    }
                    cell.textContent = `WH${selectedWarehouse}-C-${i + 1}`;
                    cell.dataset.cellId = i + 1;

                    cell.addEventListener('mousedown', (e) => {
                        isDragging = true;
                        warehouseGrid.querySelectorAll('.warehouse-cell').forEach(c => c.classList.remove('selected-by-drag'));
                        cell.classList.add('selected-by-drag');
                        e.preventDefault();
                    });

                    cell.addEventListener('mouseover', () => {
                        if (isDragging) {
                            cell.classList.add('selected-by-drag');
                        }
                    });
                    
                    warehouseGrid.appendChild(cell);
                }
            };
            
            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    const selectedCells = warehouseGrid.querySelectorAll('.warehouse-cell.selected-by-drag');
                    const selectedCellNames = Array.from(selectedCells)
                        .map(cell => cell.textContent.split('-').slice(1).join('-')) // Get C-1, C-2 etc.
                        .sort((a, b) => {
                            const numA = parseInt(a.split('-')[1]);
                            const numB = parseInt(b.split('-')[1]);
                            return numA - numB;
                        });
                    
                    const selectedWarehouseName = warehouseSelect.options[warehouseSelect.selectedIndex].text;

                    if (locationAreaIdInput) {
                        locationAreaIdInput.value = selectedWarehouseName;
                    }
                    if (locationAreaCellInput) {
                        locationAreaCellInput.value = selectedCellNames.join(', ');
                    }
                }
            });

            warehouseSelect.addEventListener('change', renderWarehouseGrid);
            renderWarehouseGrid();

            // --- ADD BUTTON LOGIC ---
            const addButton = document.getElementById('add-button');
            addButton.addEventListener('click', () => {
                const selectedDataRows = document.querySelectorAll('.data-row-checkbox:checked');
                const selectedWarehouseCells = document.querySelectorAll('.warehouse-cell.selected-by-drag');

                if (selectedDataRows.length === 0) {
                    console.log("Please select at least one row from the data grid.");
                    return;
                }
                if (selectedWarehouseCells.length === 0) {
                    console.log("Please select at least one cell from the warehouse view.");
                    return;
                }

                const planLocText = Array.from(selectedWarehouseCells)
                    .map(cell => cell.textContent)
                    .sort((a, b) => {
                        const whA = parseInt(a.split('-')[0].replace('WH',''));
                        const cA = parseInt(a.split('-')[2]);
                        const whB = parseInt(b.split('-')[0].replace('WH',''));
                        const cB = parseInt(b.split('-')[2]);
                        if (whA !== whB) return whA - whB;
                        return cA - cB;
                    })
                    .join(', ');

                selectedDataRows.forEach(checkbox => {
                    const row = checkbox.closest('tr');
                    const planLocCell = row.cells[10]; // 11th column is Plan LOC
                    if (planLocCell) {
                        planLocCell.textContent = planLocText;
                    }
                });

                // Clear selections after adding
                selectedDataRows.forEach(checkbox => {
                    checkbox.checked = false;
                    checkbox.closest('tr').classList.remove('selected');
                });
                selectAllCheckbox.checked = false;
                selectedWarehouseCells.forEach(cell => cell.classList.remove('selected-by-drag'));
            });

            // --- REMOVE BUTTON LOGIC ---
            const removeButton = document.getElementById('remove-button');
            removeButton.addEventListener('click', () => {
                const selectedDataRows = document.querySelectorAll('.data-row-checkbox:checked');

                if (selectedDataRows.length === 0) {
                    console.log("Please select at least one row to remove Plan LOC data.");
                    return;
                }

                selectedDataRows.forEach(checkbox => {
                    const row = checkbox.closest('tr');
                    const planLocCell = row.cells[10]; // 11th column is Plan LOC
                    if (planLocCell) {
                        planLocCell.textContent = '';
                    }
                });
            });

            // --- REFRESH BUTTON LOGIC ---
            const refreshButton = document.getElementById('refresh-button');
            refreshButton.addEventListener('click', () => {
                const areaInputIds = [
                    'location-area-id', 'location-area-cell', 'est-arrival',
                    'period', 'area-size', 'est-delivery', 'area-mt', 'remark'
                ];
                areaInputIds.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.value = '';
                    }
                });
            });
        });
    </script>

</body>
</html>
